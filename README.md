# SchoolSaaS - School CRM Production

هذا هو المستودع الرئيسي لنظام SchoolSaaS لإدارة المدارس (CRM). المشروع مبني على هيكلية متعددة المشاريع (monorepo) لإدارة جميع الخدمات والتطبيقات من مكان واحد.

## نظرة عامة على الهيكل

- **/admin**: واجهة الإدارة للمسؤولين (React + TypeScript).
- **/backend**: الخادم الرئيسي وواجهة برمجة التطبيقات (Node.js + Express + PostgreSQL).
- **/mobile-parent**: تطبيق الموبايل لأولياء الأمور (React Native + Expo).
- **/mobile-teacher**: تطبيق الموبايل للمعلمين (React Native + Expo).
- **/deploy**: سكربتات النشر والنسخ الاحتياطي.
- **/docs**: المستندات وملفات الشرح.
- **/.github**: ملفات CI/CD (التكامل والنشر المستمر).
- **docker-compose.prod.yml**: ملف Docker Compose لتشغيل كل الخدمات في بيئة الإنتاج.

## البدء

1.  **استنسخ المستودع:**
    ```bash
    git clone <repository-url>
    ```
2.  **إعداد متغيرات البيئة:**
    - انسخ `.env.example` في مجلد `backend` إلى ملف جديد باسم `.env`.
    - املأ المتغيرات المطلوبة مثل معلومات الاتصال بقاعدة البيانات.
3.  **التشغيل باستخدام Docker:**
    ```bash
    docker-compose -f docker-compose.prod.yml up --build
    ```
    سيقوم هذا الأمر ببناء وتشغيل جميع الخدمات (قاعدة البيانات، الخادم، واجهة الإدارة).

-   **واجهة الإدارة:** [http://localhost:8080](http://localhost:8080)
-   **الخادم (API):** [http://localhost:5000](http://localhost:5000)

## متغيرات البيئة الهامة (Backend)

- `DATABASE_URL`: مسار الاتصال بقاعدة بيانات PostgreSQL.
- `JWT_SECRET`: مفتاح توقيع JSON Web Tokens (قيمـة قوية في الإنتاج).
- `LICENSE_SECRET`: مفتاح توقيع مفاتيح الترخيص (HMAC) لمولّد ومتحقِّق الترخيص.
- `LICENSE_KEY`: مفتاح الترخيص المفعل لهذا التثبيت. عند توفّره، يتم تفعيل الوحدات المحددة بداخله.

## نظام الترخيص

- إنشاء مفتاح ترخيص: من لوحة المدير العام (المسار `/superadmin/license`) استخدم واجهة "إدارة التراخيص" لتوليد مفتاح لمدرسة معيّنة مع الوحدات المختارة وتاريخ انتهاء اختياري.
- تفعيل الترخيص: ضع القيمة الناتجة في متغير البيئة `LICENSE_KEY` وأعد تشغيل الخادم.
- فرض الوحدات: نقاط API الخاصة بالوحدات المحمية (مثل المالية والنقل المدرسي) تتطلب أن تكون الوحدة مرخّصة وإلا تُعاد استجابة 403.