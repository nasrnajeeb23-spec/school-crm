# الدليل المالي — مطابق للمنصة

## إعداد الرسوم (Fee Setup)
- الحقول (مطابقة للنموذج `backend/models/FeeSetup.js`):
  - `schoolId` رقم المدرسة (يُضبط تلقائيًا)
  - `stage` المرحلة الدراسية (نص)
  - `tuitionFee`, `bookFees`, `uniformFees`, `activityFees` مبالغ الرسوم
  - `paymentPlanType`: أحد القيم `Monthly | Termly | Installments`
  - `paymentPlanDetails` (JSON)، `discounts` (JSON قائمة)
- الخطوات الصحيحة (المسارات: `backend/routes/schoolAdmin.js:1467–1489`, `1491–1505`, `1715–1733`, `1735–1740`):
  1. افتح قسم الرسوم.
  2. أضف مرحلة جديدة وحدد الرسوم وقيم الخطة والتخفيضات بدقة.
  3. احفظ، ثم راجع قائمة الرسوم للتأكد من القيم.
  4. للتعديل: افتح السجل وحدّث القيم المطلوبة.
  5. للحذف: احذف السجل مع التأكد من عدم وجود اعتماديات مرتبطة.

## إعداد الرسوم
1. افتح قسم الرسوم.
2. أضف مرحلة جديدة وحدد الرسوم (الدراسة/الكتب/الزي/الأنشطة).
3. اختر خطة الدفع (شهري/فصلي/أقساط).

## الفواتير (Invoices) — توليد/عرض
- عرض الفواتير حسب المدرسة (يشمل الطالب ضمن نفس `schoolId`): `backend/routes/schoolAdmin.js:197–215` و`1148–1171`.
- توليد جماعي: `backend/routes/schoolAdmin.js:1774–1852` يبني قائمة الطلبة وفق المرحلة/الفصل.
- الخطوات:
  1. افتح قسم المالية ← الفواتير.
  2. حدّد معايير الطلاب (المرحلة/الفصل).
  3. اضغط توليد الفواتير الجماعي.
  4. راجع الحالات: `PAID | UNPAID | OVERDUE`.

## المدفوعات (Payments)
- تسجيل مدفوعات لفاتورة: المسار `backend/routes/schoolAdmin.js:1192–1208`.
- الخطوات:
  1. افتح الفاتورة.
  2. أدخل مبلغ الدفع، طريقة الدفع، رقم العملية إن وجد.
  3. احفظ وتحقق من تحديث حالة الفاتورة.

## تقارير مالية بلا أخطاء
1. راجع الفواتير المتأخرة أسبوعيًا.
2. تأكد من وجود الفهارس: `invoice (studentId,dueDate)` كما أُضيف في `backend/models/Invoice.js`.
3. فعّل كاش التحليلات لضمان سرعة الطلبات المتكررة.

