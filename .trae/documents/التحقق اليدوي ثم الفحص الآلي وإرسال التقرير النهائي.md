# خطة التنفيذ النهائية

## الهدف
تأكيد جاهزية النظام بالكامل عبر التحقق اليدوي لمسارات الـ API، ثم تشغيل الفحص الآلي وإرسال تقرير نهائي يؤكد ok:true لكل الخطوات، وبعده البدء بتحسينات واجهة المرفقات في الدردشة.

## المرحلة 1: التحقق اليدوي
1. إعادة تشغيل الخادم تحت إدارة PM2 والتأكد من عملية واحدة فقط.
2. انتظار 3–5 ثوانٍ لضمان جاهزية المسارات.
3. تنفيذ التحققات اليدوية بالترتيب:
   - تسجيل دخول المدير العام: `POST /api/auth/login` مع `{ email: super@admin.com, password: password }` وجلب `token`.
   - صحة المراسلة: `GET /api/messaging` بهيدر `Authorization: Bearer <token>` ويجب أن يعيد `{ ok: true }`.
   - إنشاء محادثة: `POST /api/messaging/conversations` بهيدر JWT وجسم `{ title, schoolId, parentId }` وإرجاع `{ id, roomId, title }`.
   - محاكاة النقل: `GET /api/transportation/routes/rt_01/simulate?progress=80` ثم `?progress=100` بهيدر JWT ويجب أن يعيد `{ ok: true }`.
   - تسجيل دخول ولي الأمر: `POST /api/auth/login` ثم `GET /api/parent/par_001/dashboard` بهيدر JWT ويجب أن يعيد ok:true.

## المرحلة 2: الفحص الآلي النهائي
1. تشغيل السكربت `node scripts/e2e-smoke.js` بعد التحقق اليدوي.
2. التأكد أن كل الخطوات تظهر ok:true:
   - login_superadmin, superadmin_stats, login_school_admin, list_students, create_student, create_invoice, pay_invoice, messaging_flow, transport_sim_80, transport_sim_100, parent_dashboard.
3. إرسال تقرير نهائي بالعربية يلخّص حالة كل خطوة.

## المرحلة 3: تحسينات واجهة المرفقات (بعد نجاح الفحص)
1. صور inline داخل فقاعات الرسائل بحجم مناسب وحدود مستديرة.
2. ملفات غير الصور (PDF/Word/Excel/Zip): أيقونة نوع الملف + اسم وحجم وزر فتح/تنزيل واضح.
3. تذييل موحّد يعرض الوقت وحالة الإرسال ومعلومات المرفق.
4. إزالة أي اعتماد متبقٍ على بيانات وهمية، واعتماد socket.io-client من npm لضمان ثبات الاتصال.

## مخرجات
- تقرير نهائي ok:true لكل الخطوات.
- بدء تنفيذ تحسينات واجهة المرفقات مباشرة بعد التقرير.

يرجى تأكيد المضي بالتنفيذ وفق هذه الخطة، وسأعود بالتقرير النهائي فور اكتماله.